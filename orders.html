<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boom Pizza - Orders</title>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>
        :root { --accent: #ff3131; --bg: #0a0b0d; --card: #16181d; --gold: #ffc107; }
        body { font-family: 'Vazirmatn', sans-serif; background: var(--bg); color: white; margin: 0; padding: 15px; }
        
        .header { text-align: center; padding: 15px; border-bottom: 2px solid var(--accent); margin-bottom: 20px; }
        .order-card { background: var(--card); border-radius: 20px; padding: 20px; margin-bottom: 20px; border: 1px solid #25282e; position: relative; animation: slideIn 0.5s ease; }
        
        /* Ø¦Ø§ÛŒÚ©Û†Ù†ÛŒ Ù†ÙˆÛ Ø¨Û† Ù…Ø§ÙˆÛ•ÛŒ Ù¥ Ø®ÙˆÙ„Û•Ú© */
        .new-badge { 
            position: absolute; top: -10px; left: -10px; 
            background: var(--accent); color: white; padding: 5px 15px; 
            border-radius: 50px; font-weight: 900; font-size: 0.8rem;
            box-shadow: 0 0 15px var(--accent); animation: blink 1s infinite;
        }

        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        .id-badge { color: var(--gold); font-weight: 900; font-size: 1.2rem; }
        .items-box { background: #1f2229; padding: 15px; border-radius: 12px; margin: 15px 0; border: 1px solid #333; }
        .btn-print { background: white; color: black; padding: 12px; border-radius: 10px; border: none; font-weight: bold; width: 100%; cursor: pointer; }

        /* Ø¨Û•Ø´ÛŒ ÙˆÛ•Ø³Úµ Ø¨Û† Ú†Ø§Ù¾Ú©Ø±Ø¯Ù† */
        #print-area { display: none; }
        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { display: block !important; position: absolute; left: 0; top: 0; width: 100%; color: black; background: white; padding: 20px; }
            .r-head { text-align: center; font-size: 24px; font-weight: 900; border-bottom: 2px solid black; padding-bottom: 10px; }
            .r-id { font-size: 20px; font-weight: 900; text-align: center; margin: 15px 0; border: 1px solid black; }
        }
    </style>
</head>
<body>

    <div class="header"><h1>ğŸ• Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ Ø¨ÙˆÙ… Ù¾ÛŒØªØ²Ø§</h1></div>
    <div id="list">Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù† Ø¨Û•...</div>
    <div id="print-area"></div>

    <audio id="order-sound" src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3"></audio>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDqoOjm4m1Fxp760mJPy0sv5_NjaJfkm7g",
            authDomain: "boompizza-5d048.firebaseapp.com",
            databaseURL: "https://boompizza-5d048-default-rtdb.firebaseio.com",
            projectId: "boompizza-5d048",
            storageBucket: "boompizza-5d048.firebasestorage.app",
            messagingSenderId: "636068289590",
            appId: "1:636068289590:web:41fe758906140c700ecc97"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let lastOrderCount = -1;

        function doPrint(id, items, total, phone, time, note) {
            const area = document.getElementById('print-area');
            area.innerHTML = `
                <div class="r-head">BOOM PIZZA</div>
                <div class="r-id">Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ #${id}</div>
                <p><b>Ú©Ø§Øª:</b> ${time}</p>
                <p><b>Ù…Û†Ø¨Ø§ÛŒÙ„:</b> ${phone}</p>
                <hr>
                <p><b>Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ:</b><br>${items}</p>
                ${note !== 'Ù†ÛŒÛŒÛ•' ? `<p><b>ØªÛØ¨ÛŒÙ†ÛŒ:</b> ${note}</p>` : ''}
                <hr>
                <h3 style="text-align:left">Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ: ${total} Ø¯.Ø¹</h3>
            `;
            window.print();
        }

        db.ref('orders').on('value', (snapshot) => {
            const listDiv = document.getElementById('list');
            const data = snapshot.val();
            listDiv.innerHTML = '';
            
            if (data) {
                const keys = Object.keys(data);
                
                // Ù„ÛØ¯Ø§Ù†ÛŒ Ø¯Û•Ù†Ú¯ Ø¦Û•Ú¯Û•Ø± Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ù†ÙˆÛ Ù‡Ø§Øª
                if (lastOrderCount !== -1 && keys.length > lastOrderCount) {
                    document.getElementById('order-sound').play().catch(e => console.log("Ø¯Û•Ù†Ú¯ Ú©Ø§Ø±Ù†Ø§Ú©Ø§Øª ØªØ§ Ú©Ù„ÛŒÚ© Ù†Û•Ú©Û•ÛŒØª"));
                }
                lastOrderCount = keys.length;

                // Ú•ÛŒØ²Ú©Ø±Ø¯Ù†: Ù†ÙˆÛØªØ±ÛŒÙ† Ù„Û• Ø³Û•Ø±Û•ÙˆÛ•
                keys.reverse().forEach(key => {
                    const o = data[key];
                    const itemsStr = Array.isArray(o.items) ? o.items.join(' + ') : o.items;
                    
                    // Ù„Û†Ø¬ÛŒÚ©ÛŒ Ø¦Ø§ÛŒÚ©Û†Ù†ÛŒ "New" Ø¨Û† Ù…Ø§ÙˆÛ•ÛŒ Ù¥ Ø®ÙˆÙ„Û•Ú©
                    let isNew = false;
                    if(o.time) {
                        const orderTime = new Date(o.time).getTime();
                        const now = new Date().getTime();
                        if (now - orderTime < 5 * 60 * 1000) isNew = true;
                    }

                    listDiv.innerHTML += `
                        <div class="order-card">
                            ${isNew ? '<div class="new-badge">NEW âœ¨</div>' : ''}
                            <div style="display:flex; justify-content:space-between">
                                <span class="id-badge">#${o.id}</span>
                                <small style="color:#888">${o.time || ''}</small>
                            </div>
                            <div class="items-box"><b>Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ:</b><br> ${itemsStr}</div>
                            <div style="margin-bottom:15px">ğŸ’° Ú©Û†: <b>${o.total}</b> | ğŸ“± ${o.phone}</div>
                            <button class="btn-print" onclick="doPrint('${o.id}', '${itemsStr}', '${o.total}', '${o.phone}', '${o.time}', '${o.note}')">Ú†Ø§Ù¾Ú©Ø±Ø¯Ù†ÛŒ ÙˆÛ•Ø³Úµ ğŸ–¨ï¸</button>
                        </div>
                    `;
                });
            }
        });
    </script>
</body>
</html>

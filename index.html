<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Boom's Pizza | ÿ®ŸàŸÖ Ÿæ€åÿ™ÿ≤ÿß</title>
    
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#ff3131" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="apple-touch-icon" href="https://i.postimg.cc/02R8rCjV/99999999.jpg" />

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Vazirmatn', sans-serif; background-color: #0a0a0a; color: #ffffff; margin: 0; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes pulse-gold {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px 10px rgba(255, 193, 7, 0); }
        }
        .animate-pulse-gold { animation: pulse-gold 2s infinite; }
    </style>
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom": "https://esm.sh/react-dom@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
            "firebase/database": "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js",
            "lucide-react": "https://esm.sh/lucide-react@0.344.0?external=react",
            "htm": "https://esm.sh/htm@3.1.1"
        }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getDatabase, ref, onValue, push, set, update, remove } from 'firebase/database';
        import * as Lucide from 'lucide-react';
        import htm from 'htm';

        const html = htm.bind(React.createElement);

        const firebaseConfig = {
            apiKey: "AIzaSyDqoOjm4m1Fxp760mJPy0sv5_NjaJfkm7g",
            authDomain: "boompizza-5d048.firebaseapp.com",
            databaseURL: "https://boompizza-5d048-default-rtdb.firebaseio.com",
            projectId: "boompizza-5d048",
            storageBucket: "boompizza-5d048.firebasestorage.app",
            messagingSenderId: "636068289590",
            appId: "1:636068289590:web:41fe758906140c700ecc97"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const Icon = ({ name, ...props }) => {
            const LucideIcon = Lucide[name];
            return LucideIcon ? html`<${LucideIcon} ...${props} />` : null;
        };

        const App = () => {
            const [view, setView] = useState('menu');
            const [activeCategory, setActiveCategory] = useState('');
            const [allMenuItems, setAllMenuItems] = useState([]);
            const [categories, setCategories] = useState([]);
            const [cart, setCart] = useState({});
            
            // ÿ¶€ïŸÖÿßŸÜ€ï ÿ®€Ü ÿ®€ïÿ¥€å ÿ¶€ïÿØŸÖ€åŸÜ Ÿà ŸÅÿß€åÿ±ÿ®€ï€åÿ≥ŸÜ Ÿà€ï⁄© ÿÆ€Ü€åÿßŸÜ ŸÖÿßŸàŸÜ
            useEffect(() => {
                onValue(ref(db, 'categories'), (snap) => {
                    const data = snap.val();
                    const list = data ? Object.entries(data).map(([id, val]) => ({ ...val, id })) : [];
                    setCategories(list);
                    if (list.length > 0 && !activeCategory) setActiveCategory(list[0].id);
                });
                onValue(ref(db, 'menu_items'), (snapshot) => {
                    const data = snapshot.val();
                    setAllMenuItems(data ? Object.entries(data).map(([id, val]) => ({ ...val, id })) : []);
                });
            }, []);

            const filteredMenuItems = useMemo(() => {
                return allMenuItems.filter(item => item.category === activeCategory);
            }, [allMenuItems, activeCategory]);

            // ŸÑ€éÿ±€ï ÿ≥€åÿ≥ÿ™€ïŸÖ€å S, M, L ÿ≤€åÿßÿØ⁄©ÿ±ÿßŸà€ï
            const addToCart = (item, size = 'M') => {
                let finalPrice = item.price - (item.discount || 0);
                
                if (item.category === 'pizza') {
                    if (size === 'S') finalPrice -= 2000;
                    if (size === 'L') finalPrice += 3000;
                }

                const cartKey = `${item.name}-${size}`;
                setCart(prev => {
                    const existing = prev[cartKey];
                    return { 
                        ...prev, 
                        [cartKey]: { 
                            name: item.category === 'pizza' ? `${item.name} (${size})` : item.name, 
                            price: finalPrice, 
                            qty: (existing?.qty || 0) + 1 
                        } 
                    };
                });
            };

            const removeFromCart = (key) => {
                setCart(prev => {
                    const existing = prev[key];
                    if (!existing) return prev;
                    if (existing.qty > 1) return { ...prev, [key]: { ...existing, qty: existing.qty - 1 } };
                    const newCart = { ...prev }; delete newCart[key]; return newCart;
                });
            };

            const totalAmount = Object.values(cart).reduce((acc, curr) => acc + (curr.price * curr.qty), 0);

            return html`
                <div className="max-w-md mx-auto min-h-screen flex flex-col bg-[#0a0a0a]">
                    <header className="p-6 flex justify-between items-center bg-zinc-900/50 sticky top-0 z-50 border-b border-zinc-800">
                        <div onClick=${() => { const pw = prompt("Ÿæÿßÿ≥Ÿà€Üÿ±ÿØ:"); if(pw === "1998a") setView('admin'); }} className="flex items-center gap-3">
                            <img src="https://i.postimg.cc/02R8rCjV/99999999.jpg" className="w-10 h-10 rounded-xl border border-[#ff3131]" />
                            <h1 className="text-lg font-black">BOOM'S PIZZA</h1>
                        </div>
                        <button onClick=${() => setView('cart')} className="relative p-2 bg-zinc-800 rounded-lg">
                            <${Icon} name="ShoppingBag" size=${20} />
                            ${Object.keys(cart).length > 0 && html`<span className="absolute -top-1 -right-1 bg-[#ff3131] text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-bold">${Object.values(cart).reduce((a, b) => a + b.qty, 0)}</span>`}
                        </button>
                    </header>

                    ${view === 'menu' && html`
                        <main className="p-4 space-y-6 pb-24">
                            <div className="flex gap-4 overflow-x-auto no-scrollbar py-2">
                                ${categories.map(cat => html`
                                    <button onClick=${() => setActiveCategory(cat.id)} className=${`flex flex-col items-center gap-2 min-w-[70px] transition-all ${activeCategory === cat.id ? 'scale-110 opacity-100' : 'opacity-40 grayscale'}`}>
                                        <div className="w-14 h-14 rounded-full border-2 border-[#ff3131] overflow-hidden">
                                            <img src=${cat.img} className="w-full h-full object-cover" />
                                        </div>
                                        <span className="text-[10px] font-bold">${cat.name}</span>
                                    </button>
                                `)}
                            </div>

                            <div className="grid gap-4">
                                ${filteredMenuItems.map(item => html`
                                    <div className="bg-zinc-900/50 border border-zinc-800 rounded-3xl p-3 flex gap-4 items-center">
                                        <img src=${item.img} className="w-24 h-24 rounded-2xl object-cover" />
                                        <div className="flex-1">
                                            <h3 className="font-bold text-sm">${item.name}</h3>
                                            <div className="text-[#ffc107] font-black mt-1">${item.price - (item.discount || 0)} <small className="text-[10px]">ÿØ.ÿπ</small></div>
                                            
                                            ${item.category === 'pizza' ? html`
                                                <div className="flex gap-2 mt-2">
                                                    ${['S', 'M', 'L'].map(size => html`
                                                        <button onClick=${() => addToCart(item, size)} className="bg-zinc-800 hover:bg-[#ff3131] text-[10px] px-3 py-1 rounded-lg border border-zinc-700 transition-colors">${size}</button>
                                                    `)}
                                                </div>
                                            ` : html`
                                                <button onClick=${() => addToCart(item)} className="bg-white text-black text-[10px] font-black px-4 py-1.5 rounded-lg mt-2">+ ÿ≤€åÿßÿØ⁄©ÿ±ÿØŸÜ</button>
                                            `}
                                        </div>
                                    </div>
                                `)}
                            </div>
                        </main>
                    `}

                    ${view === 'cart' && html`
                        <div className="p-6 pb-32">
                            <button onClick=${() => setView('menu')} className="mb-6 flex items-center gap-2 text-zinc-400"><${Icon} name="ArrowRight" size=${16} /> ⁄Ø€ï⁄ïÿßŸÜ€ïŸà€ï</button>
                            <h2 className="text-xl font-black mb-6">ÿ≥€ïÿ®€ïÿ™€ï⁄©€ïÿ™</h2>
                            <div className="space-y-3">
                                ${Object.entries(cart).map(([key, item]) => html`
                                    <div className="bg-zinc-900 p-4 rounded-2xl flex justify-between items-center border border-zinc-800">
                                        <div>
                                            <div className="text-sm font-bold">${item.name}</div>
                                            <div className="text-[#ffc107] text-xs">${item.price * item.qty} ÿØ.ÿπ</div>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <button onClick=${() => removeFromCart(key)} className="w-7 h-7 bg-zinc-800 rounded-lg text-red-500">-</button>
                                            <span className="text-sm font-bold">${item.qty}</span>
                                            <button onClick=${() => addToCart({name: item.name.split(' (')[0], price: item.price, category: item.name.includes('(') ? 'pizza' : ''}, key.split('-')[1])} className="w-7 h-7 bg-zinc-800 rounded-lg text-green-500">+</button>
                                        </div>
                                    </div>
                                `)}
                            </div>
                            <div className="mt-8 pt-6 border-t border-zinc-800">
                                <div className="flex justify-between items-center mb-6">
                                    <span className="text-zinc-400">⁄©€Ü€å ⁄Øÿ¥ÿ™€å:</span>
                                    <span className="text-2xl font-black text-[#ff3131]">${totalAmount} ÿØ.ÿπ</span>
                                </div>
                                <button className="w-full bg-[#ff3131] py-4 rounded-2xl font-black active:scale-95 transition-transform">ŸÜÿßÿ±ÿØŸÜ€å ÿØÿßŸàÿß⁄©ÿßÿ±€å üìç</button>
                            </div>
                        </div>
                    `}

                    <nav className="fixed bottom-4 left-4 right-4 bg-zinc-900/90 backdrop-blur-xl border border-zinc-800 h-16 rounded-2xl flex items-center justify-around px-2 z-50">
                        <button onClick=${() => setView('menu')} className=${`flex flex-col items-center gap-1 ${view === 'menu' ? 'text-[#ff3131]' : 'text-zinc-500'}`}>
                            <${Icon} name="LayoutGrid" size=${20} />
                            <span className="text-[8px] font-bold">ŸÖ€éŸÜ€Ü</span>
                        </button>
                        <button className="bg-[#ff3131] p-3 rounded-full -top-6 relative border-4 border-[#0a0a0a] animate-pulse-gold">
                            <${Icon} name="Dices" size=${24} color="white" />
                        </button>
                        <button onClick=${() => setView('cart')} className=${`flex flex-col items-center gap-1 ${view === 'cart' ? 'text-[#ff3131]' : 'text-zinc-500'}`}>
                            <${Icon} name="ShoppingBag" size=${20} />
                            <span className="text-[8px] font-bold">ÿ≥€ïÿ®€ïÿ™€ï</span>
                        </button>
                    </nav>
                </div>
            `;
        };

        createRoot(document.getElementById('root')).render(html`<${App} />`);
    </script>
</body>
</html>

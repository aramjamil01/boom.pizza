<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Boom's Pizza</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Unbounded', sans-serif; background-color: black; color: white; overflow-x: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useMemo } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import htm from 'https://esm.sh/htm';
        import { initializeApp } from 'https://esm.sh/firebase@10.7.1/app';
        import { getDatabase, ref, push, onValue } from 'https://esm.sh/firebase@10.7.1/database';
        import * as LucideIcons from 'https://esm.sh/lucide-react@0.294.0';

        const html = htm.bind(React.createElement);

        // --- Firebase Configuration (Add your config here) ---
        const firebaseConfig = {
            databaseURL: "YOUR_FIREBASE_URL" 
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const Icon = ({ name, ...props }) => {
            const IconComponent = LucideIcons[name];
            return IconComponent ? React.createElement(IconComponent, props) : null;
        };

        const App = () => {
            const [view, setView] = useState('menu');
            const [cart, setCart] = useState({});
            const [activeCategory, setActiveCategory] = useState('pizza');
            const [orderNote, setOrderNote] = useState('');
            const [isSending, setIsSending] = useState(false);
            const [lastOrder, setLastOrder] = useState(null);

            const categories = [
                { id: 'pizza', name: 'پیتزا', img: 'https://images.unsplash.com/photo-1513104890138-7c749659a591?w=200' },
                { id: 'burger', name: 'بەرگر', img: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=200' },
                { id: 'drinks', name: 'خواردنەوە', img: 'https://images.unsplash.com/photo-1622483767028-3f66f32aef97?w=200' }
            ];

            const menuItems = [
                { id: 1, category: 'pizza', name: 'مارگریتا', price: 8000, img: 'https://images.unsplash.com/photo-1574071318508-1cdbad80ad50?w=400' },
                { id: 2, category: 'pizza', name: 'پێپەرۆنی', price: 10000, img: 'https://images.unsplash.com/photo-1628840042765-356cda07504e?w=400' },
                { id: 3, category: 'burger', name: 'چیزبەرگر', price: 6000, img: 'https://images.unsplash.com/photo-1550547660-d9450f859349?w=400' }
            ];

            const filteredMenuItems = menuItems.filter(item => item.category === activeCategory);
            const totalAmount = Object.values(cart).reduce((acc, item) => acc + (item.price * item.qty), 0);

            const addToCart = (item, size = 'M') => {
                let finalPrice = item.price;
                let displayName = item.name;

                if (item.category === 'pizza') {
                    if (size === 'S') finalPrice -= 2000;
                    if (size === 'L') finalPrice += 3000;
                    displayName = `${item.name} (${size})`;
                }

                const cartKey = `${item.id}-${size}`;
                setCart(prev => {
                    const existing = prev[cartKey];
                    return { ...prev, [cartKey]: { ...item, name: displayName, price: finalPrice, qty: (existing?.qty || 0) + 1 } };
                });
            };

            const removeFromCart = (key) => {
                setCart(prev => {
                    const newCart = { ...prev };
                    if (newCart[key].qty > 1) newCart[key].qty -= 1;
                    else delete newCart[key];
                    return newCart;
                });
            };

            const getGeoLocation = () => {
                return new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(
                        (p) => resolve(`https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`),
                        (err) => { alert("تکایە لۆکەیشن چالاک بکە"); reject(err); },
                        { enableHighAccuracy: true }
                    );
                });
            };

            const submitOrder = async () => {
                setIsSending(true);
                try {
                    const loc = await getGeoLocation();
                    const orderData = {
                        orderID: Math.floor(1000 + Math.random() * 9000),
                        items: Object.values(cart).map(i => `${i.qty}x ${i.name}`).join(", "),
                        total: totalAmount,
                        location: loc,
                        note: orderNote || "تێبینی نییە",
                        time: new Date().toLocaleTimeString('ku-IQ')
                    };
                    await push(ref(db, 'orders'), orderData);
                    setLastOrder(orderData);
                    setCart({});
                    setView('menu');
                } catch (e) { console.error(e); }
                finally { setIsSending(false); }
            };

            return html`
                <div className="min-h-screen">
                    <header className="p-4 flex justify-between items-center border-b border-zinc-800 sticky top-0 bg-black/90 backdrop-blur-md z-50">
                        <h1 className="font-black text-xl text-[#ff3131]">BOOM'S PIZZA</h1>
                        <button onClick=${() => setView('menu')}><${Icon} name="Home" /></button>
                    </header>

                    ${view === 'menu' ? html`
                        <div className="flex p-4 gap-4 overflow-x-auto no-scrollbar">
                            ${categories.map(cat => html`
                                <div onClick=${() => setActiveCategory(cat.id)} className="text-center flex-shrink-0">
                                    <img src=${cat.img} className=${`w-16 h-16 rounded-2xl border-2 ${activeCategory === cat.id ? 'border-red-600' : 'border-zinc-800'}`} />
                                    <p className="text-[10px] mt-1 font-bold">${cat.name}</p>
                                </div>
                            `)}
                        </div>

                        <div className="p-4 space-y-4">
                            ${filteredMenuItems.map(item => html`
                                <div className="bg-zinc-900 p-3 rounded-3xl flex gap-4">
                                    <img src=${item.img} className="w-24 h-24 rounded-2xl object-cover" />
                                    <div className="flex-1 flex flex-col justify-between">
                                        <h3 className="font-bold">${item.name}</h3>
                                        <p className="text-red-500 font-black">${item.price} د.ع</p>
                                        ${item.category === 'pizza' ? html`
                                            <div className="flex gap-2">
                                                ${['S', 'M', 'L'].map(sz => html`
                                                    <button onClick=${() => addToCart(item, sz)} className="bg-zinc-800 px-3 py-1 rounded-lg text-xs"> ${sz} </button>
                                                `)}
                                            </div>
                                        ` : html`
                                            <button onClick=${() => addToCart(item)} className="bg-white text-black px-4 py-1 rounded-xl text-xs font-bold w-fit">زیادکردن +</button>
                                        `}
                                    </div>
                                </div>
                            `)}
                        </div>

                        ${totalAmount > 0 && html`
                            <div className="fixed bottom-6 left-4 right-4 bg-red-600 p-4 rounded-3xl flex justify-between items-center shadow-2xl">
                                <span className="font-black">${totalAmount} د.ع</span>
                                <button onClick=${() => setView('cart')} className="bg-white text-black px-6 py-2 rounded-2xl font-bold">بینینی سەبەتە</button>
                            </div>
                        `}
                    ` : html`
                        <div className="p-6">
                            <h2 className="text-2xl font-black mb-6">داواکارییەکانت</h2>
                            <div className="space-y-4 mb-6">
                                ${Object.entries(cart).map(([key, item]) => html`
                                    <div className="flex justify-between items-center bg-zinc-900 p-4 rounded-2xl">
                                        <span>${item.name}</span>
                                        <div className="flex gap-4">
                                            <button onClick=${() => removeFromCart(key)}>-</button>
                                            <span>${item.qty}</span>
                                            <button onClick=${() => addToCart(item, key.split('-')[1])}>+</button>
                                        </div>
                                    </div>
                                `)}
                            </div>
                            <textarea value=${orderNote} onChange=${(e) => setOrderNote(e.target.value)} placeholder="تێبینی..." className="w-full bg-zinc-900 p-4 rounded-2xl mb-6 outline-none border border-zinc-800 focus:border-red-600"></textarea>
                            <button onClick=${submitOrder} disabled=${isSending} className="w-full bg-red-600 py-4 rounded-2xl font-black text-lg">
                                ${isSending ? 'تکایە چاوەڕێ بکە...' : 'ناردنی داواکاری (GPS)'}
                            </button>
                        </div>
                    `}
                </div>
            `;
        };

        createRoot(document.getElementById('root')).render(html`<${App} />`);
    </script>
</body>
</html>
